# cambiar la ruta a en la que se tiene guardado el toquen !!!!!!!!!!!!!!
# y en la que se guarda los datos en crudo
# y tener instalada la libreria de requests

# PARA IDENTIFICAR LA UID DE CADA ESTACION EN LAS CIUDADES DE LA ZONA METROPOLITANA

import requests

def buscar_aqi(city_name):
    
    # Leer el token
    with open(r"C:\Users\juang\Documents\FCFM\2do Semestre\Programacion Basica\PIA\token_aqicn.txt", "r") as f:
        token = f.read().strip()

    url = f"https://api.waqi.info/feed/{city_name}/?token={token}"
    respuesta = requests.get(url)
    data = respuesta.json()
    if data['data'] != 'Unknown station':
        udi = data['data']['idx']
    else: 
        udi = None
        print("Estacion desconocida")
    
    registro = {"ciudad": city_name, "udi": udi, "data": data}
    return registro

def main():
    
    info = []
    ciudades = ['santa-catarina','monterrey','guadalupe','apodaca','juarez','cadereyta','garcia','san-nicolas-de-los-garza','general-escobedo','san-pedro-garza-garcia']
    while True:
        op = int(input("Ingrese alguna opcion\n1. Buscar por nombre de ciudad\n2. Guardar la informacion\n3. Terminar\nSeleccionado: "))
        
        # busca las ciudades ingresadas en la variable ciudades
        if op == 1:
            for ciudad in ciudades:
                datos = buscar_aqi(ciudad)
                info.append(datos)
        
        # guarda la informacion de todas las ciudades 
        elif op == 2:
            # guardar la informacion en crudo
            info_amm = open(r"C:\Users\juang\Documents\FCFM\2do Semestre\Programacion Basica\PIA\info_amm.txt", "w")
            info_amm.write(str(info))
            info_amm.close()
        
        # cerrar el programa
        elif op == 3:
            break

main()
